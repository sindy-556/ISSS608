{
  "hash": "4da071ea6d286bb7bf0436e8b8a88b73",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Take-home Exercise 1\"\nauthor: \"Sindy\"\ndate-modified: \"last-modified\"\nexecute:\n  echo: true\n  eval: true\n  warning: false\n  freeze: true\n---\n\n\n\n\n\n## Getting started\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npacman::p_load(tidyverse, plotly, GGally, patchwork, ggridges, ggcorrplot, broom,caret, pROC, factoextra, ggalluvial, ggeffects, randomForest)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nheart_data <- read_csv(\"data/japan_heart_attack_dataset.csv\")\n\n# Check structure\nglimpse(heart_data)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nRows: 30,000\nColumns: 32\n$ Age                     <dbl> 56, 69, 46, 32, 60, 25, 78, 38, 56, 75, 36, 40…\n$ Gender                  <chr> \"Male\", \"Male\", \"Male\", \"Female\", \"Female\", \"F…\n$ Region                  <chr> \"Urban\", \"Urban\", \"Rural\", \"Urban\", \"Rural\", \"…\n$ Smoking_History         <chr> \"Yes\", \"No\", \"Yes\", \"No\", \"No\", \"No\", \"No\", \"Y…\n$ Diabetes_History        <chr> \"No\", \"No\", \"No\", \"No\", \"No\", \"No\", \"Yes\", \"No…\n$ Hypertension_History    <chr> \"No\", \"No\", \"No\", \"No\", \"No\", \"No\", \"Yes\", \"No…\n$ Cholesterol_Level       <dbl> 186.4002, 185.1367, 210.6966, 211.1655, 223.81…\n$ Physical_Activity       <chr> \"Moderate\", \"Low\", \"Low\", \"Moderate\", \"High\", …\n$ Diet_Quality            <chr> \"Poor\", \"Good\", \"Average\", \"Good\", \"Good\", \"Go…\n$ Alcohol_Consumption     <chr> \"Low\", \"Low\", \"Moderate\", \"High\", \"High\", \"Hig…\n$ Stress_Levels           <dbl> 3.644786, 3.384056, 3.810911, 6.014878, 6.8068…\n$ BMI                     <dbl> 33.96135, 28.24287, 27.60121, 23.71729, 19.771…\n$ Heart_Rate              <dbl> 72.30153, 57.45764, 64.65870, 55.13147, 76.667…\n$ Systolic_BP             <dbl> 123.90209, 129.89331, 145.65490, 131.78522, 10…\n$ Diastolic_BP            <dbl> 85.68281, 73.52426, 71.99481, 68.21133, 92.902…\n$ Family_History          <chr> \"No\", \"Yes\", \"No\", \"No\", \"No\", \"No\", \"No\", \"No…\n$ Heart_Attack_Occurrence <chr> \"No\", \"No\", \"No\", \"No\", \"No\", \"No\", \"No\", \"No\"…\n$ Extra_Column_1          <dbl> 0.40498852, 0.03627815, 0.85297888, 0.39085280…\n$ Extra_Column_2          <dbl> 0.43330004, 0.51256694, 0.21959083, 0.29684675…\n$ Extra_Column_3          <dbl> 0.62871236, 0.66839275, 0.61343656, 0.15572404…\n$ Extra_Column_4          <dbl> 0.70160955, 0.11552874, 0.50800995, 0.87025144…\n$ Extra_Column_5          <dbl> 0.49814235, 0.42381938, 0.90066981, 0.39035591…\n$ Extra_Column_6          <dbl> 0.007901312, 0.083932768, 0.227205241, 0.40318…\n$ Extra_Column_7          <dbl> 0.79458257, 0.68895108, 0.49634358, 0.74140891…\n$ Extra_Column_8          <dbl> 0.29077922, 0.83016364, 0.75210679, 0.22396813…\n$ Extra_Column_9          <dbl> 0.49719307, 0.63449028, 0.18150125, 0.32931387…\n$ Extra_Column_10         <dbl> 0.52199452, 0.30204337, 0.62918031, 0.14319054…\n$ Extra_Column_11         <dbl> 0.79965663, 0.04368285, 0.01827617, 0.90778075…\n$ Extra_Column_12         <dbl> 0.72239788, 0.45166789, 0.06322702, 0.54232201…\n$ Extra_Column_13         <dbl> 0.1487387, 0.8786714, 0.1465122, 0.9224606, 0.…\n$ Extra_Column_14         <dbl> 0.8340099, 0.5356022, 0.9972962, 0.6262165, 0.…\n$ Extra_Column_15         <dbl> 0.061632229, 0.617825340, 0.974455410, 0.22860…\n```\n\n\n:::\n\n```{.r .cell-code}\n# (Optional) Clean or rename columns if needed\n# heart_data <- heart_data %>%\n#   rename(Age = age, etc...)\n\n# Decide on \"Youth\" vs. \"Adult\" threshold\n# For demonstration, let's assume 'Youth' < 40, 'Adult' >= 40\nheart_data <- heart_data %>%\n  mutate(Age_Group = if_else(Age < 40, \"Youth\", \"Adult\"))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nheart_data[duplicated(heart_data),]\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 0 × 33\n# ℹ 33 variables: Age <dbl>, Gender <chr>, Region <chr>, Smoking_History <chr>,\n#   Diabetes_History <chr>, Hypertension_History <chr>,\n#   Cholesterol_Level <dbl>, Physical_Activity <chr>, Diet_Quality <chr>,\n#   Alcohol_Consumption <chr>, Stress_Levels <dbl>, BMI <dbl>,\n#   Heart_Rate <dbl>, Systolic_BP <dbl>, Diastolic_BP <dbl>,\n#   Family_History <chr>, Heart_Attack_Occurrence <chr>, Extra_Column_1 <dbl>,\n#   Extra_Column_2 <dbl>, Extra_Column_3 <dbl>, Extra_Column_4 <dbl>, …\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nfor(column_name in names(heart_data)) {\n  na_count <- sum(is.na(heart_data[[column_name]]))\n\n  if (na_count > 0) {\n    message(\"Column '\", column_name, \"' has \", na_count, \" NA values.\")\n  }\n}\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Inspect variance and correlation of \"Extra_Column_x\"\nextra_cols <- grep(\"^Extra_Column_\", names(heart_data), value = TRUE)\n\n# Quick summary\nsummary(heart_data[extra_cols])\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n Extra_Column_1     Extra_Column_2      Extra_Column_3      Extra_Column_4     \n Min.   :0.000007   Min.   :0.0000052   Min.   :0.0000227   Min.   :0.0000934  \n 1st Qu.:0.253308   1st Qu.:0.2473606   1st Qu.:0.2483093   1st Qu.:0.2522110  \n Median :0.500820   Median :0.4961980   Median :0.4976104   Median :0.4976175  \n Mean   :0.501939   Mean   :0.4978940   Mean   :0.4981949   Mean   :0.5005952  \n 3rd Qu.:0.750529   3rd Qu.:0.7473954   3rd Qu.:0.7476807   3rd Qu.:0.7505662  \n Max.   :0.999965   Max.   :0.9999894   Max.   :0.9999694   Max.   :0.9999869  \n Extra_Column_5     Extra_Column_6      Extra_Column_7      Extra_Column_8     \n Min.   :0.000105   Min.   :0.0000531   Min.   :0.0000678   Min.   :0.0000449  \n 1st Qu.:0.251803   1st Qu.:0.2559989   1st Qu.:0.2482839   1st Qu.:0.2509790  \n Median :0.501987   Median :0.5017726   Median :0.4988157   Median :0.4985698  \n Mean   :0.501410   Mean   :0.5027631   Mean   :0.4980753   Mean   :0.5003557  \n 3rd Qu.:0.753657   3rd Qu.:0.7511886   3rd Qu.:0.7456378   3rd Qu.:0.7507293  \n Max.   :0.999995   Max.   :0.9998892   Max.   :0.9999900   Max.   :0.9999300  \n Extra_Column_9      Extra_Column_10     Extra_Column_11    \n Min.   :0.0000305   Min.   :0.0000133   Min.   :0.0000008  \n 1st Qu.:0.2502452   1st Qu.:0.2484256   1st Qu.:0.2538092  \n Median :0.4984491   Median :0.5031040   Median :0.5067589  \n Mean   :0.5002292   Mean   :0.5010694   Mean   :0.5044949  \n 3rd Qu.:0.7512186   3rd Qu.:0.7522686   3rd Qu.:0.7556257  \n Max.   :0.9999852   Max.   :0.9999928   Max.   :0.9999578  \n Extra_Column_12     Extra_Column_13     Extra_Column_14    \n Min.   :0.0000713   Min.   :0.0000204   Min.   :0.0000025  \n 1st Qu.:0.2505341   1st Qu.:0.2473108   1st Qu.:0.2482152  \n Median :0.5038609   Median :0.5041162   Median :0.4943841  \n Mean   :0.5008624   Mean   :0.5004557   Mean   :0.4976507  \n 3rd Qu.:0.7511780   3rd Qu.:0.7497094   3rd Qu.:0.7456212  \n Max.   :0.9999484   Max.   :0.9999451   Max.   :0.9999779  \n Extra_Column_15    \n Min.   :0.0000241  \n 1st Qu.:0.2482573  \n Median :0.5009406  \n Mean   :0.4999634  \n 3rd Qu.:0.7487379  \n Max.   :0.9999913  \n```\n\n\n:::\n\n```{.r .cell-code}\n# Quick correlation with Heart_Attack_Occurrence (assuming \"Yes\"/\"No\" -> 1/0 conversion)\nheart_data <- heart_data %>%\n  mutate(HA_Flag = if_else(Heart_Attack_Occurrence == \"Yes\", 1, 0))\n\ncor_vals <- sapply(heart_data[extra_cols], function(col) cor(col, heart_data$HA_Flag, use=\"complete.obs\"))\ncor_vals\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n Extra_Column_1  Extra_Column_2  Extra_Column_3  Extra_Column_4  Extra_Column_5 \n   0.0068723720    0.0081270829    0.0018814255    0.0101384226   -0.0029298992 \n Extra_Column_6  Extra_Column_7  Extra_Column_8  Extra_Column_9 Extra_Column_10 \n  -0.0048613508    0.0011395071    0.0012963044    0.0056251485   -0.0006013661 \nExtra_Column_11 Extra_Column_12 Extra_Column_13 Extra_Column_14 Extra_Column_15 \n  -0.0035566466   -0.0005152565   -0.0047901932   -0.0010651777   -0.0038557783 \n```\n\n\n:::\n\n```{.r .cell-code}\n# If these correlations are all near zero & the columns have little variance => likely useless\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Convert Heart_Attack_Occurrence to a binary flag (if not already done)\nheart_data <- heart_data %>%\n  mutate(HA_Flag = if_else(Heart_Attack_Occurrence == \"Yes\", 1, 0))\n\n# Identify all numeric columns in the data frame\nnumeric_cols <- names(heart_data)[sapply(heart_data, is.numeric)]\n# Optionally, remove the HA_Flag column from the list to avoid correlating it with itself\nnumeric_cols <- setdiff(numeric_cols, \"HA_Flag\")\n\n# Compute the correlation between each numeric column and HA_Flag\ncor_vals <- sapply(numeric_cols, function(col) {\n  cor(heart_data[[col]], heart_data$HA_Flag, use = \"complete.obs\")\n})\n\n# Print the correlation values\ncor_vals\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n              Age Cholesterol_Level     Stress_Levels               BMI \n     0.0053339546     -0.0011603955     -0.0120851026     -0.0052151153 \n       Heart_Rate       Systolic_BP      Diastolic_BP    Extra_Column_1 \n     0.0054838870     -0.0053873653      0.0043340331      0.0068723720 \n   Extra_Column_2    Extra_Column_3    Extra_Column_4    Extra_Column_5 \n     0.0081270829      0.0018814255      0.0101384226     -0.0029298992 \n   Extra_Column_6    Extra_Column_7    Extra_Column_8    Extra_Column_9 \n    -0.0048613508      0.0011395071      0.0012963044      0.0056251485 \n  Extra_Column_10   Extra_Column_11   Extra_Column_12   Extra_Column_13 \n    -0.0006013661     -0.0035566466     -0.0005152565     -0.0047901932 \n  Extra_Column_14   Extra_Column_15 \n    -0.0010651777     -0.0038557783 \n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Visualization 1: Age Distribution (Ridge or Histogram) + Overlaid by Heart Attack Occurrence\np1 <- heart_data %>%\n  ggplot(aes(x = Age, fill = Heart_Attack_Occurrence)) +\n  geom_histogram(position = \"identity\", alpha = 0.6, bins = 30) +\n  facet_wrap(~Age_Group, scales = \"free_y\") +\n  labs(title = \"Age Distribution by Group and Heart Attack Occurrence\",\n       x = \"Age\", y = \"Count\") +\n  theme_minimal()\n\np1\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex1_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(heart_data, aes(x = Smoking_History, fill = Heart_Attack_Occurrence)) +\n  geom_bar(position = \"dodge\") +\n  labs(title = \"Smoking History vs. Heart Attack Occurrence\",\n       x = \"Smoking History\", y = \"Count\") +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex1_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Suppose these are factors\ndf_alluvial <- heart_data %>%\n  select(Smoking_History, Hypertension_History, Diabetes_History, Heart_Attack_Occurrence) %>%\n  na.omit()\n\nggplot(df_alluvial,\n       aes(axis1 = Smoking_History, \n           axis2 = Hypertension_History,\n           axis3 = Diabetes_History,\n           y = 1, fill = Heart_Attack_Occurrence)) +\n  geom_alluvium(aes(color = Heart_Attack_Occurrence), width = 1/12) +\n  geom_stratum(width = 1/12, fill = \"grey80\", color = \"white\") +\n  geom_text(stat = \"stratum\", aes(label = after_stat(stratum))) +\n  scale_x_discrete(limits = c(\"Smoking\", \"Hypertension\", \"Diabetes\"),\n                   expand = c(.05, .05)) +\n  labs(title=\"Combined Categorical Risk Factors vs. Heart Attack Outcome\",\n       x=\"\", y=\"Number of Records\") +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex1_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(heart_data, aes(x = Cholesterol_Level, y = Heart_Attack_Occurrence, fill = Heart_Attack_Occurrence)) +\n  geom_density_ridges(alpha = 0.7) +\n  theme_minimal() +\n  labs(title=\"Cholesterol Level Distribution by Heart Attack Occurrence\",\n       x=\"Cholesterol Level\", y=\"\")\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex1_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggalluvial)\n\n# Suppose these are factors\ndf_alluvial <- heart_data %>%\n  select(Smoking_History, Hypertension_History, Diabetes_History, Heart_Attack_Occurrence) %>%\n  na.omit()\n\nggplot(df_alluvial,\n       aes(axis1 = Smoking_History, \n           axis2 = Hypertension_History,\n           axis3 = Diabetes_History,\n           y = 1, fill = Heart_Attack_Occurrence)) +\n  geom_alluvium(aes(color = Heart_Attack_Occurrence), width = 1/12) +\n  geom_stratum(width = 1/12, fill = \"grey80\", color = \"white\") +\n  geom_text(stat = \"stratum\", aes(label = after_stat(stratum))) +\n  scale_x_discrete(limits = c(\"Smoking\", \"Hypertension\", \"Diabetes\"),\n                   expand = c(.05, .05)) +\n  labs(title=\"Combined Categorical Risk Factors vs. Heart Attack Outcome\",\n       x=\"\", y=\"Number of Records\") +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex1_files/figure-html/unnamed-chunk-11-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(heart_data, aes(x = BMI, y = Cholesterol_Level, color = Heart_Attack_Occurrence)) +\n  geom_point(alpha=0.3) +\n  geom_smooth(method = \"loess\") +\n  theme_minimal() +\n  labs(title=\"BMI vs. Cholesterol, Colored by Heart Attack Occurrence\",\n       x=\"BMI\", y=\"Cholesterol\")\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex1_files/figure-html/unnamed-chunk-12-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Fit logistic regression\nmodel_logit <- glm(HA_Flag ~ BMI + Systolic_BP + Stress_Levels + \n                   Smoking_History + Diabetes_History + Hypertension_History,\n                   data = heart_data, family=binomial)\n\neffects_bmi <- ggemmeans(model_logit, terms=\"BMI\")\nggplot(effects_bmi, aes(x, predicted)) +\n  geom_line() +\n  geom_ribbon(aes(ymin = conf.low, ymax = conf.high), alpha=0.2) +\n  labs(title=\"Partial Effect of BMI on Heart Attack Probability\",\n       x=\"BMI\", y=\"Predicted Probability of Heart Attack\") +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex1_files/figure-html/unnamed-chunk-13-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(heart_data, aes(x = Region, fill = Heart_Attack_Occurrence)) +\n  geom_bar(position = \"fill\") +\n  labs(title = \"Proportion of Heart Attacks by Region\",\n       x = \"Region\", y = \"Proportion\") +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex1_files/figure-html/unnamed-chunk-14-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(randomForest)\nset.seed(123)\n\nmodel_rf <- randomForest(factor(HA_Flag) ~ Age + BMI + Cholesterol_Level +\n                         Smoking_History + Diabetes_History + \n                         Hypertension_History + Family_History + Stress_Levels,\n                         data = heart_data, ntree=200, importance=TRUE)\n\nvarImpPlot(model_rf)\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex1_files/figure-html/unnamed-chunk-15-1.png){width=672}\n:::\n:::\n",
    "supporting": [
      "Take-home_Ex1_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}